From ea2c874011a1608c464624d9814ea3165a5450e3 Mon Sep 17 00:00:00 2001
From: Claude <noreply@anthropic.com>
Date: Wed, 12 Nov 2025 04:18:40 +0000
Subject: [PATCH] Improve user invitations UI and functionality

- Replace dropdown menu with icon buttons in InvitationsList for better UX
- Remove EDIT button from user view page as requested
- Fix pending tab count to update immediately after creating invitation
- Fetch all invitation statuses and invited users count after creation
- Remove unused MoreVertical import and openMenuId state
- Add loading spinner to Resend button when processing
- ConfirmationDialog already in use for Suspend action
---
 src/components/users/InvitationsList.tsx | 165 +++++++----------------
 src/pages/settings/users/index.tsx       |  18 ++-
 src/pages/settings/users/userView.tsx    |  15 +--
 3 files changed, 65 insertions(+), 133 deletions(-)

diff --git a/src/components/users/InvitationsList.tsx b/src/components/users/InvitationsList.tsx
index 6c86b4a..b7bf768 100644
--- a/src/components/users/InvitationsList.tsx
+++ b/src/components/users/InvitationsList.tsx
@@ -11,7 +11,6 @@ import {
   RefreshCw,
   Eye,
   Copy,
-  MoreVertical,
   AlertCircle,
   User
 } from 'lucide-react';
@@ -37,7 +36,6 @@ const InvitationsList: React.FC<InvitationsListProps> = ({
   isLoading = false
 }) => {
   const [processingIds, setProcessingIds] = useState<Set<string>>(new Set());
-  const [openMenuId, setOpenMenuId] = useState<string | null>(null);
   const [cancelDialogOpen, setCancelDialogOpen] = useState(false);
   const [invitationToCancel, setInvitationToCancel] = useState<string | null>(null);
   const { isDarkMode, currentTheme } = useTheme();
@@ -108,15 +106,13 @@ const InvitationsList: React.FC<InvitationsListProps> = ({
         newSet.delete(invitationId);
         return newSet;
       });
-      setOpenMenuId(null);
     }
   };
-  
+
   // Handle cancel - open confirmation dialog
   const handleCancelClick = (invitationId: string) => {
     setInvitationToCancel(invitationId);
     setCancelDialogOpen(true);
-    setOpenMenuId(null);
   };
 
   // Confirm cancel
@@ -310,115 +306,58 @@ const InvitationsList: React.FC<InvitationsListProps> = ({
                 </div>
               </div>
               
-              {/* Actions */}
-              <div className="relative">
-                <button
-                  onClick={() => setOpenMenuId(openMenuId === invitation.id ? null : invitation.id)}
-                  disabled={isProcessing}
-                  className="p-2 rounded-md transition-all duration-200 hover:opacity-80"
-                  style={{ 
-                    backgroundColor: `${colors.utility.primaryText}10`,
-                    color: colors.utility.primaryText
-                  }}
-                >
-                  <MoreVertical size={16} />
-                </button>
-                
-                {openMenuId === invitation.id && (
-                  <div 
-                    className="absolute right-0 mt-1 w-48 border rounded-md shadow-lg z-10 transition-colors"
-                    style={{
-                      backgroundColor: colors.utility.secondaryBackground,
-                      borderColor: `${colors.utility.primaryText}20`
-                    }}
+              {/* Actions - Icon Buttons */}
+              <div className="flex items-center gap-2">
+                {onViewDetails && (
+                  <button
+                    onClick={() => onViewDetails(invitation)}
+                    disabled={isProcessing}
+                    className="p-2 rounded-md transition-colors hover:opacity-80"
+                    title="View Details"
+                    style={{ color: colors.brand.primary }}
                   >
-                    <div className="py-1">
-                      {onViewDetails && (
-                        <button
-                          onClick={() => {
-                            onViewDetails(invitation);
-                            setOpenMenuId(null);
-                          }}
-                          className="w-full px-4 py-2 text-sm text-left flex items-center transition-all duration-200 hover:opacity-80"
-                          style={{ 
-                            color: colors.utility.primaryText,
-                            backgroundColor: 'transparent'
-                          }}
-                          onMouseEnter={(e) => {
-                            e.currentTarget.style.backgroundColor = `${colors.utility.primaryText}10`;
-                          }}
-                          onMouseLeave={(e) => {
-                            e.currentTarget.style.backgroundColor = 'transparent';
-                          }}
-                        >
-                          <Eye size={14} className="mr-2" />
-                          View Details
-                        </button>
-                      )}
-                      
-                      {invitation.invitation_link && (
-                        <button
-                          onClick={() => copyInvitationLink(invitation)}
-                          className="w-full px-4 py-2 text-sm text-left flex items-center transition-all duration-200 hover:opacity-80"
-                          style={{ 
-                            color: colors.utility.primaryText,
-                            backgroundColor: 'transparent'
-                          }}
-                          onMouseEnter={(e) => {
-                            e.currentTarget.style.backgroundColor = `${colors.utility.primaryText}10`;
-                          }}
-                          onMouseLeave={(e) => {
-                            e.currentTarget.style.backgroundColor = 'transparent';
-                          }}
-                        >
-                          <Copy size={14} className="mr-2" />
-                          Copy Link
-                        </button>
-                      )}
-                      
-                      {canResend && (
-                        <button
-                          onClick={() => handleResend(invitation.id)}
-                          disabled={isProcessing}
-                          className="w-full px-4 py-2 text-sm text-left flex items-center transition-all duration-200 hover:opacity-80"
-                          style={{ 
-                            color: colors.utility.primaryText,
-                            backgroundColor: 'transparent'
-                          }}
-                          onMouseEnter={(e) => {
-                            e.currentTarget.style.backgroundColor = `${colors.utility.primaryText}10`;
-                          }}
-                          onMouseLeave={(e) => {
-                            e.currentTarget.style.backgroundColor = 'transparent';
-                          }}
-                        >
-                          <RefreshCw size={14} className="mr-2" />
-                          Resend
-                        </button>
-                      )}
-                      
-                      {canCancel && (
-                        <button
-                          onClick={() => handleCancelClick(invitation.id)}
-                          disabled={isProcessing}
-                          className="w-full px-4 py-2 text-sm text-left flex items-center transition-all duration-200 hover:opacity-80"
-                          style={{
-                            color: colors.semantic.error,
-                            backgroundColor: 'transparent'
-                          }}
-                          onMouseEnter={(e) => {
-                            e.currentTarget.style.backgroundColor = `${colors.semantic.error}10`;
-                          }}
-                          onMouseLeave={(e) => {
-                            e.currentTarget.style.backgroundColor = 'transparent';
-                          }}
-                        >
-                          <XCircle size={14} className="mr-2" />
-                          Cancel
-                        </button>
-                      )}
-                    </div>
-                  </div>
+                    <Eye size={16} />
+                  </button>
+                )}
+
+                {invitation.invitation_link && (
+                  <button
+                    onClick={() => copyInvitationLink(invitation)}
+                    disabled={isProcessing}
+                    className="p-2 rounded-md transition-colors hover:opacity-80"
+                    title="Copy Link"
+                    style={{ color: colors.brand.primary }}
+                  >
+                    <Copy size={16} />
+                  </button>
+                )}
+
+                {canResend && (
+                  <button
+                    onClick={() => handleResend(invitation.id)}
+                    disabled={isProcessing}
+                    className="p-2 rounded-md transition-colors hover:opacity-80"
+                    title="Resend Invitation"
+                    style={{ color: colors.brand.tertiary || colors.brand.primary }}
+                  >
+                    {isProcessing ? (
+                      <RefreshCw size={16} className="animate-spin" />
+                    ) : (
+                      <RefreshCw size={16} />
+                    )}
+                  </button>
+                )}
+
+                {canCancel && (
+                  <button
+                    onClick={() => handleCancelClick(invitation.id)}
+                    disabled={isProcessing}
+                    className="p-2 rounded-md transition-colors hover:opacity-80"
+                    title="Cancel Invitation"
+                    style={{ color: colors.semantic.error }}
+                  >
+                    <XCircle size={16} />
+                  </button>
                 )}
               </div>
             </div>
diff --git a/src/pages/settings/users/index.tsx b/src/pages/settings/users/index.tsx
index 94e5bcb..274d1f2 100644
--- a/src/pages/settings/users/index.tsx
+++ b/src/pages/settings/users/index.tsx
@@ -187,14 +187,20 @@ const UsersPage: React.FC = () => {
     if (invitation) {
       setShowInviteModal(false);
 
-      // Always fetch invitations to update the pending count immediately
-      await fetchInvitations(1, 'pending');
+      // Fetch all invitation statuses and users to update all counts immediately
+      await Promise.all([
+        fetchInvitations(1, 'all'),
+        fetchInvitations(1, 'pending'),
+        fetchInvitations(1, 'accepted'),
+        fetchInvitations(1, 'expired'),
+        fetchUsers(1, 'invited') // Update invited users count
+      ]);
 
-      // Reset loaded state to force refresh
-      setDataLoaded(prev => ({ ...prev, all: false, pending: false }));
+      // Reset loaded state to force refresh of all tabs
+      setDataLoaded({ all: false, active: false, pending: false });
 
-      // Refresh current tab
-      if (activeTab === 'pending' || activeTab === 'all') {
+      // Refresh current tab display if needed
+      if (activeTab !== 'all') {
         await handleRefresh();
       }
     }
diff --git a/src/pages/settings/users/userView.tsx b/src/pages/settings/users/userView.tsx
index 7c6a7cf..d2a05aa 100644
--- a/src/pages/settings/users/userView.tsx
+++ b/src/pages/settings/users/userView.tsx
@@ -225,19 +225,6 @@ const UserViewPage: React.FC = () => {
           <div className="flex items-center gap-2">
             {!isOwnProfile && (
               <>
-                <button
-                  onClick={handleEdit}
-                  className="px-3 py-2 border rounded-md transition-colors hover:opacity-80 flex items-center gap-2"
-                  style={{
-                    borderColor: colors.utility.primaryText + '40',
-                    backgroundColor: colors.utility.secondaryBackground,
-                    color: colors.utility.primaryText
-                  }}
-                >
-                  <Edit size={16} />
-                  Edit
-                </button>
-                
                 {user.status === 'active' && (
                   <button
                     onClick={handleSuspend}
@@ -253,7 +240,7 @@ const UserViewPage: React.FC = () => {
                     Suspend
                   </button>
                 )}
-                
+
                 {user.status === 'suspended' && (
                   <button
                     onClick={handleActivate}
-- 
2.43.0


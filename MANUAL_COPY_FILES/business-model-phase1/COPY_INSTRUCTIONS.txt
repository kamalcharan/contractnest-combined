═══════════════════════════════════════════════════════════════════════════════
BUSINESS MODEL PHASE 1 - DELIVERABLES 1 & 2
═══════════════════════════════════════════════════════════════════════════════

Date: 2025-01-11
Branch: business-model-phase1
Author: Claude Code Session

═══════════════════════════════════════════════════════════════════════════════
FILES INCLUDED
═══════════════════════════════════════════════════════════════════════════════

1. contractnest-edge/supabase/migrations/business-model-v2/001_schema_evolution.sql
   Purpose: Evolve existing Business Model tables for composite billing
   Status: APPLIED ✅

2. contractnest-edge/supabase/migrations/business-model-v2/002_new_tables.sql
   Purpose: Create new tables for Business Model Agent
   Status: PENDING

═══════════════════════════════════════════════════════════════════════════════
DELIVERABLE 2: NEW TABLES
═══════════════════════════════════════════════════════════════════════════════

Tables Created:

1. t_bm_product_config
   - Product billing configurations (JSONB)
   - Stores complete billing model per product

2. t_bm_credit_balance
   - Tenant credit balances per type/channel
   - Supports expiry and low balance alerts
   - Row-level locking for atomic operations

3. t_bm_credit_transaction
   - Append-only audit trail for credit operations
   - Full transaction history with references

4. t_bm_topup_pack
   - Available credit topup packages
   - Pricing, quantity, optional expiry
   - Promotion support

5. t_contract_invoice
   - Contract billing (tenant → their customer)
   - Full payment lifecycle tracking
   - Settlement and platform fee tracking

6. t_bm_billing_event
   - Billing event log for async processing
   - Webhook handling with idempotency
   - Retry and dead letter support

═══════════════════════════════════════════════════════════════════════════════
COPY COMMANDS (Windows PowerShell)
═══════════════════════════════════════════════════════════════════════════════

# Navigate to project root
cd "D:\projects\core projects\ContractNest\contractnest-combined"

# Copy Deliverable 2 migration file
Copy-Item "MANUAL_COPY_FILES\business-model-phase1\contractnest-edge\supabase\migrations\business-model-v2\002_new_tables.sql" -Destination "contractnest-edge\supabase\migrations\business-model-v2\" -Force

Write-Host "Migration file copied!" -ForegroundColor Green

═══════════════════════════════════════════════════════════════════════════════

P1+ EQUIPMENT WIRING — Steps 1 & 2 (v3 — backend fix)
======================================================
Branch: feature/p1-equipment
Date: 2026-02-15

ROOT CAUSE FIX
==============
The backend API's transformMasterData() in productMasterdataService.ts was
stripping form_settings from all responses. This meant:
  - Nomenclature cards were never grouped (all in "other" group)
  - is_equipment_based flag was always undefined
  - Asset selection step could never appear

Fix: Added "form_settings: item.form_settings" to transformMasterData()

SUBMODULES AFFECTED
===================
1. contractnest-api  (1 file — the root cause fix)
2. contractnest-ui   (3 files — wizard + nomenclature + equipment card)

FILES MODIFIED (4 files total)
==============================

--- contractnest-api (1 file) ---

1. contractnest-api/src/services/productMasterdataService.ts
   - Added form_settings to transformMasterData() output
   - This is the ROOT CAUSE fix — without this, form_settings is stripped from API responses

--- contractnest-ui (3 files) ---

2. contractnest-ui/src/pages/equipment-registry/EquipmentCard.tsx
   - Added 3-mode support: 'edit' (default), 'selectable' (wizard), 'readOnly' (detail)
   - Accepts both TenantAsset and ClientAsset types

3. contractnest-ui/src/components/contracts/ContractWizard/index.tsx
   - Added nomenclatureRequiresAssets boolean to ContractWizardState
   - Renamed CONTRACT_STEPS to CONTRACT_STEPS_ALL
   - Asset step conditionally shown based on nomenclature type
   - Handler receives form_settings from NomenclatureStep

4. contractnest-ui/src/components/contracts/ContractWizard/steps/NomenclatureStep.tsx
   - Updated onSelect callback to pass form_settings as third argument

COPY COMMANDS (PowerShell)
==========================

cd "D:\projects\core projects\ContractNest\contractnest-combined"

# API fix (ROOT CAUSE)
Copy-Item "MANUAL_COPY_FILES\feature-p1-equipment-wiring\contractnest-api\src\services\productMasterdataService.ts" -Destination "contractnest-api\src\services\productMasterdataService.ts" -Force

# UI changes
Copy-Item "MANUAL_COPY_FILES\feature-p1-equipment-wiring\contractnest-ui\src\pages\equipment-registry\EquipmentCard.tsx" -Destination "contractnest-ui\src\pages\equipment-registry\EquipmentCard.tsx" -Force

Copy-Item "MANUAL_COPY_FILES\feature-p1-equipment-wiring\contractnest-ui\src\components\contracts\ContractWizard\index.tsx" -Destination "contractnest-ui\src\components\contracts\ContractWizard\index.tsx" -Force

Copy-Item "MANUAL_COPY_FILES\feature-p1-equipment-wiring\contractnest-ui\src\components\contracts\ContractWizard\steps\NomenclatureStep.tsx" -Destination "contractnest-ui\src\components\contracts\ContractWizard\steps\NomenclatureStep.tsx" -Force

Write-Host "All 4 files copied!" -ForegroundColor Green

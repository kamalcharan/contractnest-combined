â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ MANUAL COPY INSTRUCTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Branch: claude/whatsapp-bot-profile-search-01MR3u8ibbM31ydizJSyAvr6
Date: December 6, 2025
Feature: WhatsApp Bot - Chat Service, Internal API Key, CHAT Routes

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ SUMMARY OF CHANGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

This update implements:
1. CHAT endpoints in serviceURLs.ts (centralized UI endpoint management)
2. Updated chatService.ts to use centralized endpoints
3. Internal API key authentication for API-to-Edge communication
4. CHAT routes in Edge Function with internal key protection

Security: API-to-Edge requests now require INTERNAL_API_SECRET header
N8N: Workflows use their own Supabase/LLM credentials (no changes needed)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ FILES TO COPY (4 FILES)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SUBMODULE: contractnest-ui
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. src/services/serviceURLs.ts
   FROM: MANUAL_COPY_FILES/contractnest-ui/src/services/serviceURLs.ts
   TO:   D:\projects\core projects\ContractNest\contractnest-combined\contractnest-ui\src\services\

   Changes: Added CHAT section to API_ENDPOINTS with:
   - INIT, SESSION, SESSION_BY_ID, ACTIVATE, INTENT, SEARCH, END endpoints
   - ChatSearchOptions type definition
   - ChatEndpoints type export
   - Helper function for building search requests

2. src/services/chatService.ts
   FROM: MANUAL_COPY_FILES/contractnest-ui/src/services/chatService.ts
   TO:   D:\projects\core projects\ContractNest\contractnest-combined\contractnest-ui\src\services\

   Changes: Updated to import from serviceURLs.ts:
   - Removed local CHAT_ENDPOINTS constant
   - Now uses API_ENDPOINTS.CHAT.INIT, .SESSION, etc.
   - Follows coding standard: centralized endpoint management


SUBMODULE: contractnest-api
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3. src/services/groupsService.ts
   FROM: MANUAL_COPY_FILES/contractnest-api/src/services/groupsService.ts
   TO:   D:\projects\core projects\ContractNest\contractnest-combined\contractnest-api\src\services\

   Changes: Added internal API key header:
   - INTERNAL_API_SECRET from env
   - getHeaders() now includes 'x-internal-key' header
   - All API-to-Edge calls authenticated


SUBMODULE: contractnest-edge
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
4. supabase/functions/groups/index.ts
   FROM: MANUAL_COPY_FILES/contractnest-edge/supabase/functions/groups/index.ts
   TO:   D:\projects\core projects\ContractNest\contractnest-combined\contractnest-edge\supabase\functions\groups\

   Changes: Added CHAT routes with internal key protection:
   - Updated CORS headers (x-internal-key, x-environment)
   - Internal API key validation
   - Protected endpoints: /chat/session, /chat/activate, /chat/intent, /chat/search, /chat/end
   - Public endpoint: /chat/init (intro message only)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš™ï¸ ENVIRONMENT VARIABLES REQUIRED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Add to your .env files:

For contractnest-api (.env):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
INTERNAL_API_SECRET=your-strong-secret-key-here-min-32-chars

For contractnest-edge (Supabase secrets):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
INTERNAL_API_SECRET=your-strong-secret-key-here-min-32-chars

IMPORTANT: Both must use the SAME value!

Generate a strong key:
- Use: openssl rand -base64 32
- Or: node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’» WINDOWS POWERSHELL COMMANDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Step 1: Navigate to your project root
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
cd "D:\projects\core projects\ContractNest\contractnest-combined"

Step 2: Backup existing files (optional but recommended)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
$backupDir = "BACKUP_$timestamp"
New-Item -ItemType Directory -Path $backupDir -Force

# Backup UI files
Copy-Item "contractnest-ui\src\services\serviceURLs.ts" "$backupDir\serviceURLs.ts.bak" -Force
Copy-Item "contractnest-ui\src\services\chatService.ts" "$backupDir\chatService.ts.bak" -Force

# Backup API file
Copy-Item "contractnest-api\src\services\groupsService.ts" "$backupDir\groupsService.ts.bak" -Force

# Backup Edge file
Copy-Item "contractnest-edge\supabase\functions\groups\index.ts" "$backupDir\groups-index.ts.bak" -Force

Step 3: Copy new files from MANUAL_COPY_FILES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Copy UI files
Copy-Item "MANUAL_COPY_FILES\contractnest-ui\src\services\serviceURLs.ts" "contractnest-ui\src\services\serviceURLs.ts" -Force
Copy-Item "MANUAL_COPY_FILES\contractnest-ui\src\services\chatService.ts" "contractnest-ui\src\services\chatService.ts" -Force

# Copy API file
Copy-Item "MANUAL_COPY_FILES\contractnest-api\src\services\groupsService.ts" "contractnest-api\src\services\groupsService.ts" -Force

# Copy Edge file
Copy-Item "MANUAL_COPY_FILES\contractnest-edge\supabase\functions\groups\index.ts" "contractnest-edge\supabase\functions\groups\index.ts" -Force

Step 4: Set environment variables
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Generate a secret key (copy the output)
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"

# Add to contractnest-api/.env
Add-Content -Path "contractnest-api\.env" -Value "`nINTERNAL_API_SECRET=YOUR_GENERATED_KEY_HERE"

# For Supabase Edge Function, set via Supabase CLI:
# supabase secrets set INTERNAL_API_SECRET=YOUR_GENERATED_KEY_HERE

Step 5: Verify files copied correctly
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Check file exists and show first few lines
Get-Content "contractnest-ui\src\services\serviceURLs.ts" -Head 10
Get-Content "contractnest-ui\src\services\chatService.ts" -Head 10
Get-Content "contractnest-api\src\services\groupsService.ts" -Head 10
Get-Content "contractnest-edge\supabase\functions\groups\index.ts" -Head 10

Step 6: Verify CHAT section exists in serviceURLs.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Select-String -Path "contractnest-ui\src\services\serviceURLs.ts" -Pattern "CHAT:" -Context 2,10


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… TESTING CHECKLIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

After copying files, test the following:

[ ] 1. Start the UI dev server:
      cd contractnest-ui && npm run dev

[ ] 2. Start the API server:
      cd contractnest-api && npm run dev

[ ] 3. Test CHAT init (public - should work):
      curl -X POST http://localhost:3000/api/chat/init \
        -H "Content-Type: application/json" \
        -H "Authorization: Bearer YOUR_TOKEN" \
        -d '{}'

[ ] 4. Test CHAT session without internal key (should fail with 403):
      curl -X POST http://localhost:3000/api/chat/session \
        -H "Content-Type: application/json" \
        -H "Authorization: Bearer YOUR_TOKEN" \
        -d '{"channel":"web"}'

[ ] 5. Test CHAT session with internal key (should work):
      curl -X POST http://localhost:3000/api/chat/session \
        -H "Content-Type: application/json" \
        -H "Authorization: Bearer YOUR_TOKEN" \
        -H "x-internal-key: YOUR_INTERNAL_SECRET" \
        -d '{"channel":"web"}'

[ ] 6. Verify UI chatService uses centralized endpoints:
      - Open browser dev tools
      - Navigate to VaNi chat
      - Check network requests go to /api/chat/* endpoints

[ ] 7. Verify internal key is sent from API to Edge:
      - Check API logs for x-internal-key header
      - Check Edge function logs for internal key validation


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” SECURITY NOTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Internal API Key Flow:
   UI -> API Server -> Edge Function

   - UI calls API (public endpoints)
   - API adds x-internal-key header
   - Edge validates internal key before processing

2. Protected CHAT Endpoints (require internal key):
   - POST /chat/session
   - POST /chat/activate
   - POST /chat/intent
   - POST /chat/search
   - POST /chat/end

3. Public CHAT Endpoint (no internal key needed):
   - POST /chat/init (returns intro message only)

4. N8N Webhooks:
   - Have their own Supabase/LLM credentials
   - Called by Edge Function with proper auth
   - No changes needed to n8n workflows


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ FILE SIZE REFERENCE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

serviceURLs.ts:    ~45 KB (1315 lines)
chatService.ts:    ~7 KB (262 lines)
groupsService.ts:  ~34 KB (1061 lines)
index.ts (Edge):   ~52 KB (1674 lines)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”„ ROLLBACK INSTRUCTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

If you need to rollback:

# Restore from backup
Copy-Item "BACKUP_$timestamp\serviceURLs.ts.bak" "contractnest-ui\src\services\serviceURLs.ts" -Force
Copy-Item "BACKUP_$timestamp\chatService.ts.bak" "contractnest-ui\src\services\chatService.ts" -Force
Copy-Item "BACKUP_$timestamp\groupsService.ts.bak" "contractnest-api\src\services\groupsService.ts" -Force
Copy-Item "BACKUP_$timestamp\groups-index.ts.bak" "contractnest-edge\supabase\functions\groups\index.ts" -Force


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â„¹ï¸ ADDITIONAL NOTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

- No new npm dependencies required
- No database migrations required (uses existing tables)
- SQL functions (get_vani_intro_message, etc.) should already exist
- All changes are backward compatible
- Theme-aware components (dark/light mode supported)

Database tables used:
- t_chat_sessions (session management)
- t_query_cache (search result caching)
- t_business_groups (group lookup)
- t_group_memberships (member search)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ SUPPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

If you encounter issues:
1. Check browser console for API errors
2. Check API server logs for internal key issues
3. Check Edge function logs in Supabase dashboard
4. Verify INTERNAL_API_SECRET matches in both .env files


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¤– AI AGENT FEATURE (December 14, 2025)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

This section documents the AI Agent database migrations and TypeScript types.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ AI AGENT FILES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

MIGRATIONS (Run in Supabase SQL Editor - IN ORDER):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
migrations/ai-agent/001_create_ai_agent_sessions.sql    - Sessions table
migrations/ai-agent/002_add_ai_agent_config_to_groups.sql - Config schema
migrations/ai-agent/003_create_user_lookup_rpc.sql      - User phone lookup
migrations/ai-agent/004_create_session_rpcs.sql         - Session management RPCs
migrations/ai-agent/005_create_group_activation_rpc.sql - "Hi BBB" detection
migrations/ai-agent/006_create_access_check_rpc.sql     - RBAC check RPCs
migrations/ai-agent/007_create_scoped_search_rpcs.sql   - Search RPCs
migrations/ai-agent/008_seed_bbb_ai_config.sql          - BBB seed data

TYPESCRIPT TYPES (Copy to contractnest-api):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FROM: MANUAL_COPY_FILES/contractnest-api/src/types/groups.ts
TO:   contractnest-api/src/types/groups.ts

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’» AI AGENT POWERSHELL COMMANDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Step 1: Copy TypeScript types
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Copy-Item "MANUAL_COPY_FILES\contractnest-api\src\types\groups.ts" -Destination "contractnest-api\src\types\groups.ts" -Force

Step 2: Commit API submodule
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
cd contractnest-api
git add src/types/groups.ts
git commit -m "Add AI Agent TypeScript types"
git push origin main
cd ..

Step 3: Update parent repo
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
git add contractnest-api
git commit -m "Update contractnest-api with AI Agent types"
git push origin master

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… AI AGENT TESTING CHECKLIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

After running SQL migrations, test in Supabase SQL Editor:

[ ] 1. Test user lookup:
      SELECT * FROM get_user_by_phone('+919876543210');

[ ] 2. Test activation detection:
      SELECT * FROM detect_group_activation('Hi BBB');

[ ] 3. Test exit detection:
      SELECT * FROM detect_group_activation('Bye');

[ ] 4. List AI-enabled groups:
      SELECT * FROM get_ai_enabled_groups();

[ ] 5. Test access check (use real UUIDs):
      SELECT * FROM check_user_group_access('user-uuid', 'group-uuid');

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”¢ AI AGENT RPC FUNCTIONS (18 total)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

User Lookup:
- get_user_by_phone(phone)
- normalize_phone(phone)

Config:
- get_ai_agent_config(group_id)
- is_ai_agent_enabled(group_id)

Session Management:
- get_ai_session(phone)
- create_ai_session(user_id, phone, group_id, channel, language)
- update_ai_session(session_id, context, language, add_message)
- end_ai_session(phone)
- switch_ai_session(phone, new_group_id, language)
- cleanup_expired_ai_sessions()

Activation Detection:
- detect_group_activation(message)
- get_ai_enabled_groups()
- is_exit_command(message)

Access Control:
- check_user_group_access(user_id, group_id)
- check_phone_group_access(phone, group_id)
- get_user_accessible_groups(user_id)

Scoped Search:
- scoped_member_search(query_text, embedding, scope, group_id, limit, threshold)
- get_members_by_scope(scope, group_id, industry, search_text, limit, offset)
- get_member_contact(membership_id, scope, group_id)
- get_segments_by_scope(scope, group_id)

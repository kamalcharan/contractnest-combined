═══════════════════════════════════════════════════════════════════════════════
FIX: RLS Violation When Creating Tenant Profile During Onboarding
═══════════════════════════════════════════════════════════════════════════════

ISSUE: Error code 42501 - "new row violates row-level security policy for table t_tenant_profiles"

ROOT CAUSE:
The tenant-profile edge function was passing user's Authorization header in
global.headers, which overrode the service role context. This made database
queries run as the authenticated user instead of service_role, triggering
RLS policy checks that require Owner/Admin role assignment - which may not
be complete during onboarding.

FIX APPLIED:
1. Verify user authentication via their token first
2. Verify user has access to the tenant (t_user_tenants check)
3. Use pure service role client (without user auth header) for database operations
   to bypass RLS while maintaining security

═══════════════════════════════════════════════════════════════════════════════
FILES TO COPY
═══════════════════════════════════════════════════════════════════════════════

SOURCE → DESTINATION
─────────────────────

MANUAL_COPY_FILES\contractnest-edge\supabase\functions\tenant-profile\index.ts
→ contractnest-edge\supabase\functions\tenant-profile\index.ts

═══════════════════════════════════════════════════════════════════════════════

═══════════════════════════════════════════════════
COPY INSTRUCTIONS - Catalog Studio Database Tables
═══════════════════════════════════════════════════

Files to Copy:
──────────────

DOCUMENTATION:
1. CatalogStudio-SprintPlan-v1.0.md
   FROM: MANUAL_COPY_FILES\CatalogStudio-SprintPlan-v1.0.md
   TO:   ClaudeDocumentation\contractUI\CatalogStudio-SprintPlan-v1.0.md

2. CatalogStudio-Database-Schema-v1.0.md
   FROM: MANUAL_COPY_FILES\CatalogStudio-Database-Schema-v1.0.md
   TO:   ClaudeDocumentation\contractUI\CatalogStudio-Database-Schema-v1.0.md

MIGRATIONS (Run in Supabase SQL Editor in order):
3. 001_create_cat_blocks.sql
   FROM: MANUAL_COPY_FILES\migrations\catalog-studio\001_create_cat_blocks.sql
   TO:   contractnest-edge\supabase\migrations\catalog-studio\001_create_cat_blocks.sql

4. 002_create_cat_templates.sql
   FROM: MANUAL_COPY_FILES\migrations\catalog-studio\002_create_cat_templates.sql
   TO:   contractnest-edge\supabase\migrations\catalog-studio\002_create_cat_templates.sql

5. 003_seed_master_data.sql
   FROM: MANUAL_COPY_FILES\migrations\catalog-studio\003_seed_master_data.sql
   TO:   contractnest-edge\supabase\migrations\catalog-studio\003_seed_master_data.sql

EDGE FUNCTIONS (Deploy via Supabase CLI):
6. cat-blocks/index.ts
   FROM: MANUAL_COPY_FILES\edge-functions\cat-blocks\index.ts
   TO:   contractnest-edge\supabase\functions\cat-blocks\index.ts

7. cat-templates/index.ts
   FROM: MANUAL_COPY_FILES\edge-functions\cat-templates\index.ts
   TO:   contractnest-edge\supabase\functions\cat-templates\index.ts

API FILES (Copy to contractnest-api):
8. catalogStudioTypes.ts
   FROM: MANUAL_COPY_FILES\api\catalog-studio\catalogStudioTypes.ts
   TO:   contractnest-api\src\types\catalogStudioTypes.ts

9. catBlocksService.ts
   FROM: MANUAL_COPY_FILES\api\catalog-studio\catBlocksService.ts
   TO:   contractnest-api\src\services\catBlocksService.ts

10. catTemplatesService.ts
    FROM: MANUAL_COPY_FILES\api\catalog-studio\catTemplatesService.ts
    TO:   contractnest-api\src\services\catTemplatesService.ts

11. catalogStudioController.ts
    FROM: MANUAL_COPY_FILES\api\catalog-studio\catalogStudioController.ts
    TO:   contractnest-api\src\controllers\catalogStudioController.ts

12. catalogStudioRoutes.ts
    FROM: MANUAL_COPY_FILES\api\catalog-studio\catalogStudioRoutes.ts
    TO:   contractnest-api\src\routes\catalogStudioRoutes.ts

13. index.ts (API module entry)
    FROM: MANUAL_COPY_FILES\api\catalog-studio\index.ts
    TO:   contractnest-api\src\modules\catalog-studio\index.ts

14. index.ts.integration.md (Integration Guide)
    FROM: MANUAL_COPY_FILES\api\catalog-studio\index.ts.integration.md
    ACTION: Follow steps to update contractnest-api\src\index.ts

UI FILES (Copy to contractnest-ui):
15. serviceURLs.addition.ts (Add to existing serviceURLs.ts)
    FROM: MANUAL_COPY_FILES\ui\catalog-studio\serviceURLs.addition.ts
    ACTION: Merge CATALOG_STUDIO section into contractnest-ui\src\services\serviceURLs.ts

16. useCatBlocks.ts (Query hook for blocks)
    FROM: MANUAL_COPY_FILES\ui\catalog-studio\hooks\queries\useCatBlocks.ts
    TO:   contractnest-ui\src\hooks\queries\useCatBlocks.ts

17. useCatTemplates.ts (Query hook for templates)
    FROM: MANUAL_COPY_FILES\ui\catalog-studio\hooks\queries\useCatTemplates.ts
    TO:   contractnest-ui\src\hooks\queries\useCatTemplates.ts

18. useCatBlocksMutations.ts (Mutations for blocks - admin only)
    FROM: MANUAL_COPY_FILES\ui\catalog-studio\hooks\mutations\useCatBlocksMutations.ts
    TO:   contractnest-ui\src\hooks\mutations\useCatBlocksMutations.ts

19. useCatTemplatesMutations.ts (Mutations for templates)
    FROM: MANUAL_COPY_FILES\ui\catalog-studio\hooks\mutations\useCatTemplatesMutations.ts
    TO:   contractnest-ui\src\hooks\mutations\useCatTemplatesMutations.ts

20. queries/index.ts (Queries barrel export - OPTIONAL)
    FROM: MANUAL_COPY_FILES\ui\catalog-studio\hooks\queries\index.ts
    ACTION: Add exports to existing contractnest-ui\src\hooks\queries\index.ts
            (if index.ts exists, merge exports; if not, create it)

21. mutations/index.ts (Mutations barrel export - OPTIONAL)
    FROM: MANUAL_COPY_FILES\ui\catalog-studio\hooks\mutations\index.ts
    ACTION: Add exports to existing contractnest-ui\src\hooks\mutations\index.ts
            (if index.ts exists, merge exports; if not, create it)

UI UTILITIES (Adapters for API integration):
22. catBlockAdapter.ts (Converts API CatBlock to UI Block format)
    FROM: MANUAL_COPY_FILES\ui\catalog-studio\utils\catBlockAdapter.ts
    TO:   contractnest-ui\src\utils\catalog-studio\catBlockAdapter.ts

23. catTemplateAdapter.ts (Converts API CatTemplate to UI Template format)
    FROM: MANUAL_COPY_FILES\ui\catalog-studio\utils\catTemplateAdapter.ts
    TO:   contractnest-ui\src\utils\catalog-studio\catTemplateAdapter.ts

24. utils/index.ts (Utils barrel export)
    FROM: MANUAL_COPY_FILES\ui\catalog-studio\utils\index.ts
    TO:   contractnest-ui\src\utils\catalog-studio\index.ts

UI PAGES (Fully integrated with API hooks - REPLACE existing files):
25. blocks.tsx (Blocks Library Page)
    FROM: MANUAL_COPY_FILES\ui\catalog-studio\pages\blocks.tsx
    TO:   contractnest-ui\src\pages\catalog-studio\blocks.tsx
    NOTE: Fully integrated with useCatBlocks, useCreateCatBlock, useUpdateCatBlock, useDeleteCatBlock

26. templates-list.tsx (Templates List Page)
    FROM: MANUAL_COPY_FILES\ui\catalog-studio\pages\templates-list.tsx
    TO:   contractnest-ui\src\pages\catalog-studio\templates-list.tsx
    NOTE: Fully integrated with useCatTemplates, useCatSystemTemplates, useDeleteCatTemplate, useCopyCatTemplate

27. template.tsx (Template Builder Page)
    FROM: MANUAL_COPY_FILES\ui\catalog-studio\pages\template.tsx
    TO:   contractnest-ui\src\pages\catalog-studio\template.tsx
    NOTE: Fully integrated with useCatBlocks, useCatTemplate, useSaveTemplate
          Supports edit mode via URL params: ?templateId=xxx&edit=true

UI INTEGRATION GUIDE (Reference only):
28. UI_INTEGRATION_GUIDE.md
    FROM: MANUAL_COPY_FILES\ui\catalog-studio\UI_INTEGRATION_GUIDE.md
    ACTION: Reference document - pages are now pre-integrated (items 25-27 above)

═══════════════════════════════════════════════════
Submodules Affected:
──────────────
- ClaudeDocumentation (Sprint plan + DB schema documents)
- contractnest-edge (Migration SQL files + Edge functions)
- contractnest-api (API routes, controllers, services)
- contractnest-ui (Hooks for queries and mutations)

═══════════════════════════════════════════════════
Tables Created:
──────────────
1. cat_blocks - Global blocks library (service, spare, billing, etc.)
2. cat_templates - Templates built from blocks (tenant + global)

Master Data Seeded (in m_category_master/details):
- cat_block_type (8 types)
- cat_pricing_mode (4 modes)
- cat_price_type (5 types)
- cat_block_status (3 statuses)
- cat_template_status (3 statuses)
- cat_evidence_type (7 types)
- cat_location_type (3 types)
- cat_currency (6 currencies)
- cat_payment_type (5 types)

═══════════════════════════════════════════════════
Edge Functions Created:
──────────────
1. cat-blocks - Global blocks CRUD
   - GET /cat-blocks - List all blocks (filtered by is_admin)
   - GET /cat-blocks/:id - Get single block
   - POST /cat-blocks - Create block (admin only)
   - PATCH /cat-blocks/:id - Update block (admin only)
   - DELETE /cat-blocks/:id - Soft delete (admin only)

2. cat-templates - Templates CRUD with tenant isolation
   - GET /cat-templates - List tenant templates
   - GET /cat-templates/system - List system templates
   - GET /cat-templates/public - List public templates
   - GET /cat-templates/:id - Get single template
   - POST /cat-templates - Create template
   - POST /cat-templates/:id/copy - Copy system template to tenant
   - PATCH /cat-templates/:id - Update template
   - DELETE /cat-templates/:id - Soft delete

Required Headers:
- x-signature (HMAC signature using INTERNAL_SIGNING_SECRET)
- x-timestamp (Unix timestamp for replay protection)
- x-tenant-id (Tenant UUID)
- x-user-id (User UUID)
- x-product (default: contractnest)
- x-is-admin (true/false)
- x-environment (live/test) - for cat-templates only

═══════════════════════════════════════════════════
API Endpoints (via Express):
──────────────
Base: /api/catalog-studio

BLOCKS:
  GET    /blocks           - List blocks (filtered by isAdmin)
  GET    /blocks/:id       - Get single block
  POST   /blocks           - Create block (admin only)
  PATCH  /blocks/:id       - Update block (admin only)
  DELETE /blocks/:id       - Soft delete (admin only)

TEMPLATES:
  GET    /templates        - List tenant templates
  GET    /templates/system - List system templates
  GET    /templates/public - List public templates
  GET    /templates/:id    - Get single template
  POST   /templates        - Create template
  POST   /templates/:id/copy - Copy system template
  PATCH  /templates/:id    - Update template
  DELETE /templates/:id    - Soft delete

HEALTH:
  GET    /health           - Health check

═══════════════════════════════════════════════════
Integration in contractnest-api/src/index.ts:
──────────────
See: MANUAL_COPY_FILES\api\catalog-studio\index.ts.integration.md

Quick Summary (9 steps):
1. Add route loading (~line 270)
2. Add route registration (~line 560)
3. Update health check services object (~line 600)
4. Update health check features object (~line 612)
5. Update health check try block (~line 698)
6. Update root endpoint services (~line 732)
7. Update root endpoint endpoints (~line 741)
8. Add console logging (~line 1071)
9. Update 404 handler endpoints (~line 778)

═══════════════════════════════════════════════════
UI Hooks Created:
──────────────
Query Hooks (TanStack Query):
- useCatBlocks() - Fetch blocks list with filters
- useCatBlock(id) - Fetch single block
- useCatBlocksForDropdown() - Blocks formatted for select
- useSearchCatBlocks(query) - Search blocks
- useCatBlocksByType(typeId) - Filter by block type

- useCatTemplates() - Fetch tenant templates
- useCatTemplate(id) - Fetch single template
- useCatSystemTemplates() - Fetch system templates
- useCatPublicTemplates() - Fetch public templates
- useCatTemplatesForDropdown() - Templates for select
- useAllAvailableTemplates() - All templates combined

Mutation Hooks:
- useCreateCatBlock() - Create block (admin only)
- useUpdateCatBlock() - Update block (admin only)
- useDeleteCatBlock() - Delete block (admin only)
- useToggleCatBlockStatus() - Toggle active (admin)
- useCatBlockMutationOperations() - All block mutations

- useCreateCatTemplate() - Create template
- useUpdateCatTemplate() - Update template
- useDeleteCatTemplate() - Delete template
- useCopyCatTemplate() - Copy system template
- useToggleCatTemplatePublic() - Toggle public
- useCatTemplateMutationOperations() - All template mutations
- useSaveTemplate() - Create or update (smart)

═══════════════════════════════════════════════════
UI Adapters Created:
──────────────
catBlockAdapter.ts:
- catBlockToBlock() - Convert API CatBlock to UI Block
- catBlocksToBlocks() - Convert array
- blockToCreateData() - Convert UI Block to API create format
- blockToUpdateData() - Convert UI Block updates to API format

catTemplateAdapter.ts:
- catTemplateToUITemplate() - Convert API CatTemplate to UI format
- catTemplatesToUITemplates() - Convert array
- uiTemplateToCreateData() - Convert UI template to API create format
- uiTemplateToUpdateData() - Convert UI updates to API format
- createTemplateBlock() - Create API TemplateBlock from UI data

═══════════════════════════════════════════════════
UI Pages (Pre-Integrated):
──────────────
Pages are now fully integrated with API hooks and ready for copy:

1. blocks.tsx (Items #25)
   - Uses useCatBlocks() for fetching blocks
   - Uses useCreateCatBlock(), useUpdateCatBlock(), useDeleteCatBlock()
   - Uses catBlocksToBlocks() adapter for type conversion
   - Includes loading states, error handling, and refetch capability

2. templates-list.tsx (Item #26)
   - Uses useCatTemplates(), useCatSystemTemplates(), useCatPublicTemplates()
   - Uses useDeleteCatTemplate(), useCopyCatTemplate()
   - Uses catTemplatesToUITemplates() adapter for type conversion
   - Combines tenant, system, and public templates

3. template.tsx (Item #27)
   - Uses useCatBlocks() for blocks library
   - Uses useCatTemplate() for edit mode loading
   - Uses useSaveTemplate() for create/update
   - Supports edit mode via URL: ?templateId=xxx&edit=true
   - Includes Cmd+S keyboard shortcut for saving
   - Tracks unsaved changes

═══════════════════════════════════════════════════

===============================================================
ITERATION 1 + 2: Admin Tenant Management
- Real tenant list + stats (iter 1)
- is_test badge (iter 1)
- Real data summary + 3 action buttons (iter 2)
===============================================================

Submodules Affected: contractnest-edge, contractnest-api, contractnest-ui

FILES TO COPY:
---------------------------------------------------------------

--- EDGE FUNCTION (contractnest-edge) ---

1. supabase/migrations/admin-tenant-management/001_admin_tenant_rpcs.sql
   -> SQL: get_admin_platform_stats() + get_admin_tenant_list()
   -> Includes is_test field

2. NEW: supabase/migrations/admin-tenant-management/002_tenant_data_operations.sql
   -> SQL: get_tenant_data_summary() - real row counts per table
   -> SQL: admin_reset_test_data() - delete is_live=false records
   -> SQL: admin_reset_all_data() - delete all tenant data
   -> SQL: admin_close_tenant_account() - delete all + close
   -> RUN THIS IN SUPABASE SQL EDITOR

3. supabase/functions/admin-tenant-management/index.ts
   -> Edge: GET /stats, GET /tenants, GET /data-summary
   -> Edge: POST /reset-test-data, POST /reset-all-data, POST /close-account
   -> DEPLOY: supabase functions deploy admin-tenant-management

--- API LAYER (contractnest-api) ---

4. src/services/adminTenantService.ts
   -> Added: getDataSummary(), resetTestData(), resetAllData(), closeAccount()

5. src/routes/adminTenantRoutes.ts
   -> Added: GET /:id/data-summary
   -> Added: POST /:id/reset-test-data
   -> Added: POST /:id/reset-all-data
   -> Added: POST /:id/close-account

6. src/index.ts (unchanged from iter 1)

--- UI (contractnest-ui) ---

7. src/services/serviceURLs.ts
   -> Added: DATA_SUMMARY, RESET_TEST_DATA, RESET_ALL_DATA, CLOSE_ACCOUNT endpoints

8. src/pages/admin/subscription-management/index.tsx
   -> Real data summary API call (replaces mock)
   -> 3 action handlers: handleResetTestData, handleResetAllData, handleCloseAccount
   -> Removed DeleteConfirmationFlow (replaced by inline confirm dialogs)

9. src/components/subscription/modals/TenantDetailDrawer.tsx
   -> 3 action buttons: Reset Test Data, Reset All Data, Close Account
   -> Each with description, distinct color coding

10. src/types/tenantManagement.ts (unchanged from iter 1)

11. src/components/subscription/cards/TenantCard.tsx (unchanged from iter 1)

POWERSHELL COPY COMMANDS:
---------------------------------------------------------------

cd "D:\projects\core projects\ContractNest\contractnest-combined"

# Edge - SQL + function
Copy-Item "MANUAL_COPY_FILES\iter1-admin-tenant-mgmt\contractnest-edge\supabase\migrations\admin-tenant-management\001_admin_tenant_rpcs.sql" -Destination "contractnest-edge\supabase\migrations\admin-tenant-management\001_admin_tenant_rpcs.sql" -Force
Copy-Item "MANUAL_COPY_FILES\iter1-admin-tenant-mgmt\contractnest-edge\supabase\migrations\admin-tenant-management\002_tenant_data_operations.sql" -Destination "contractnest-edge\supabase\migrations\admin-tenant-management\002_tenant_data_operations.sql" -Force
Copy-Item "MANUAL_COPY_FILES\iter1-admin-tenant-mgmt\contractnest-edge\supabase\functions\admin-tenant-management\index.ts" -Destination "contractnest-edge\supabase\functions\admin-tenant-management\index.ts" -Force

# API
Copy-Item "MANUAL_COPY_FILES\iter1-admin-tenant-mgmt\contractnest-api\src\services\adminTenantService.ts" -Destination "contractnest-api\src\services\adminTenantService.ts" -Force
Copy-Item "MANUAL_COPY_FILES\iter1-admin-tenant-mgmt\contractnest-api\src\routes\adminTenantRoutes.ts" -Destination "contractnest-api\src\routes\adminTenantRoutes.ts" -Force
Copy-Item "MANUAL_COPY_FILES\iter1-admin-tenant-mgmt\contractnest-api\src\index.ts" -Destination "contractnest-api\src\index.ts" -Force

# UI
Copy-Item "MANUAL_COPY_FILES\iter1-admin-tenant-mgmt\contractnest-ui\src\services\serviceURLs.ts" -Destination "contractnest-ui\src\services\serviceURLs.ts" -Force
Copy-Item "MANUAL_COPY_FILES\iter1-admin-tenant-mgmt\contractnest-ui\src\pages\admin\subscription-management\index.tsx" -Destination "contractnest-ui\src\pages\admin\subscription-management\index.tsx" -Force
Copy-Item "MANUAL_COPY_FILES\iter1-admin-tenant-mgmt\contractnest-ui\src\types\tenantManagement.ts" -Destination "contractnest-ui\src\types\tenantManagement.ts" -Force
Copy-Item "MANUAL_COPY_FILES\iter1-admin-tenant-mgmt\contractnest-ui\src\components\subscription\cards\TenantCard.tsx" -Destination "contractnest-ui\src\components\subscription\cards\TenantCard.tsx" -Force
New-Item -ItemType Directory -Path "contractnest-ui\src\components\subscription\modals" -Force | Out-Null
Copy-Item "MANUAL_COPY_FILES\iter1-admin-tenant-mgmt\contractnest-ui\src\components\subscription\modals\TenantDetailDrawer.tsx" -Destination "contractnest-ui\src\components\subscription\modals\TenantDetailDrawer.tsx" -Force

Write-Host "All files copied!" -ForegroundColor Green

DEPLOYMENT ORDER:
---------------------------------------------------------------
1. Run 002_tenant_data_operations.sql in Supabase SQL Editor
2. Deploy edge function: supabase functions deploy admin-tenant-management
3. Copy API files -> restart API server (npm run dev)
4. Copy UI files -> hard refresh browser (Ctrl+F5)
5. Test at /admin/subscription-management

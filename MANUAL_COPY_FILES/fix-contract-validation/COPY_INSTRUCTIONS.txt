===============================================
COPY INSTRUCTIONS -- fix-contract-validation
===============================================

Feature: Fix contract creation, list display, stats, sidebar counts, hub redesign, Contract 360° detail view
Branch: fix-contract-validation

Submodules Affected: contractnest-ui, contractnest-api

Files (10 total):
-------------------------------------------------
API (3 files):

1. contractnest-api/src/controllers/contractController.ts
   - List endpoint: transforms RPC response to match UI ContractListResponse
   - Stats endpoint: transforms RPC response to match UI ContractStatsResponse

2. contractnest-api/src/services/contractService.ts
   - Maps 'title' -> 'name', 'contact_classification' -> 'contract_type'

3. contractnest-api/src/validators/contractValidators.ts
   - Added 'client','vendor','partner' to CONTRACT_TYPES whitelist

UI (7 files):

4. contractnest-ui/src/App.tsx
   - Added import for ContractDetailPage
   - Added route: <Route path=":id" element={<ContractDetailPage />} /> under /contracts

5. contractnest-ui/src/pages/contracts/detail/index.tsx  [NEW]
   - Contract 360° View page — full lifecycle dashboard
   - Sticky header: back button, contract icon, title/meta, status pill, actions (View PDF, Edit, Send Update, Add Task)
   - Summary bar: Contract Value, Tax, Completion, Tasks, Blocks, Duration
   - Tabs: Overview (active), Timeline, Financials, Evidence, Communication, Audit Log
   - Overview tab — 2-column grid (1fr | 420px):
     Left: Blocks card (service line items), Task Timeline (placeholder), Vendors card, Attachments card
     Right: ContactHeaderCard (reused from contacts view), Financial Health, Contract Details, Audit Trail
   - Uses VaNiLoader, theme-aware colors, Lucide icons throughout
   - Reuses existing ContactHeaderCard by mapping buyer fields to contact shape

6. contractnest-ui/src/components/contracts/ContractWizard/index.tsx
   - Full payload remap to match deployed DB RPC schema
   - Passes acceptanceMethod prop to BuyerSelectionStep

6b. contractnest-ui/src/components/contracts/ContractWizard/steps/BuyerSelectionStep.tsx
   - Added acceptanceMethod prop to BuyerSelectionStepProps
   - Notification note below contact card: shows email/WhatsApp channels for payment or sign-off
   - For corporate contacts: uses selected contact person's channels when available
   - Auto-accept mode: shows simple confirmation note
   - Warnings when email or WhatsApp not configured

7. contractnest-ui/src/types/contracts.ts
   - Added optional fields: buyer_id, buyer_name, contact_id, contact_classification

8. contractnest-ui/src/pages/contracts/hub/index.tsx
   - Card-based list redesign matching contacts page pattern
   - Classification icons, VaNiLoader, Eye view button

9. contractnest-ui/src/components/layout/Sidebar.tsx
   - Real contract stats badge counts

Copy Commands (PowerShell):
-------------------------------------------------
cd "D:\projects\core projects\ContractNest\contractnest-combined"

# API (3 files)
Copy-Item "MANUAL_COPY_FILES\fix-contract-validation\contractnest-api\src\controllers\contractController.ts" -Destination "contractnest-api\src\controllers\contractController.ts" -Force
Copy-Item "MANUAL_COPY_FILES\fix-contract-validation\contractnest-api\src\services\contractService.ts" -Destination "contractnest-api\src\services\contractService.ts" -Force
Copy-Item "MANUAL_COPY_FILES\fix-contract-validation\contractnest-api\src\validators\contractValidators.ts" -Destination "contractnest-api\src\validators\contractValidators.ts" -Force

# UI (6 files — note: detail/index.tsx is NEW, create directory first)
New-Item -ItemType Directory -Path "contractnest-ui\src\pages\contracts\detail" -Force
Copy-Item "MANUAL_COPY_FILES\fix-contract-validation\contractnest-ui\src\App.tsx" -Destination "contractnest-ui\src\App.tsx" -Force
Copy-Item "MANUAL_COPY_FILES\fix-contract-validation\contractnest-ui\src\pages\contracts\detail\index.tsx" -Destination "contractnest-ui\src\pages\contracts\detail\index.tsx" -Force
Copy-Item "MANUAL_COPY_FILES\fix-contract-validation\contractnest-ui\src\components\contracts\ContractWizard\index.tsx" -Destination "contractnest-ui\src\components\contracts\ContractWizard\index.tsx" -Force
Copy-Item "MANUAL_COPY_FILES\fix-contract-validation\contractnest-ui\src\components\contracts\ContractWizard\steps\BuyerSelectionStep.tsx" -Destination "contractnest-ui\src\components\contracts\ContractWizard\steps\BuyerSelectionStep.tsx" -Force
Copy-Item "MANUAL_COPY_FILES\fix-contract-validation\contractnest-ui\src\types\contracts.ts" -Destination "contractnest-ui\src\types\contracts.ts" -Force
Copy-Item "MANUAL_COPY_FILES\fix-contract-validation\contractnest-ui\src\pages\contracts\hub\index.tsx" -Destination "contractnest-ui\src\pages\contracts\hub\index.tsx" -Force
Copy-Item "MANUAL_COPY_FILES\fix-contract-validation\contractnest-ui\src\components\layout\Sidebar.tsx" -Destination "contractnest-ui\src\components\layout\Sidebar.tsx" -Force

Write-Host "All 10 files copied!" -ForegroundColor Green
